"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = _default;

var _path = require("path");

var _fs = require("fs");

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; var ownKeys = Object.keys(source); if (typeof Object.getOwnPropertySymbols === 'function') { ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) { return Object.getOwnPropertyDescriptor(source, sym).enumerable; })); } ownKeys.forEach(function (key) { _defineProperty(target, key, source[key]); }); } return target; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

function _default(api) {
  const cwd = api.service.cwd;
  api.register('modifyAFWebpackOpts', ({
    memo
  }) => {
    memo.babel.plugins = [...(memo.babel.plugins || []), [require.resolve('babel-plugin-import'), {
      libraryName: 'antd',
      libraryDirectory: 'es',
      style: true
    }, 'antd'], [require.resolve('babel-plugin-import'), {
      libraryName: 'antd-mobile',
      libraryDirectory: 'es',
      style: true
    }, 'antd-mobile']];
    memo.alias = _objectSpread({}, memo.alias || {}, {
      'antd-mobile': (0, _path.dirname)(require.resolve('antd-mobile/package.json')),
      antd: (0, _path.dirname)(require.resolve('antd/package.json'))
    }); // 支持用户指定 antd 和 antd-mobile 的版本

    const pkgPath = (0, _path.join)(cwd, 'package.json');

    if ((0, _fs.existsSync)(pkgPath)) {
      const _require = require(pkgPath),
            _require$dependencies = _require.dependencies,
            dependencies = _require$dependencies === void 0 ? {} : _require$dependencies; // eslint-disable-line


      if (dependencies.antd) {
        memo.alias.antd = (0, _path.dirname)(require.resolve((0, _path.join)(cwd, 'node_modules/antd/package')));
      }

      if (dependencies['antd-mobile']) {
        memo.alias['antd-mobile'] = (0, _path.dirname)(require.resolve((0, _path.join)(cwd, 'node_modules/antd-mobile/package.json')));
      }
    }

    return memo;
  });
}